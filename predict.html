<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Make Predictions â€“ Occy Weekend Football</title>
  <link rel="stylesheet" href="brand.css">
  <link rel="icon" href="assets/brand-logo.png" />
</head>
<body>
  <div class="brand-header">
    <img src="assets/brand-logo.png" alt="Occy Weekend Football">
  </div>

  <div class="container card">
    <div class="header"><h1>Make Predictions</h1></div>
    <div id="fixtures"></div>
    <button class="btn" id="saveBtn">Save Predictions</button>
    <div id="msg" class="muted"></div>
  </div>

  <script src="supabase-config.js"></script>
  <script>
    async function loadFixtures() {
      let { data } = await supabase.from("fixtures").select("*").eq("featured", true);
      const box = document.getElementById("fixtures");
      if (!data || !data.length) { box.innerHTML = "No fixtures yet."; return; }
      box.innerHTML = `<table><tr><th>Match</th><th>Home</th><th>Away</th></tr>` +
        data.map(f => `<tr>
          <td>${f.home_team} vs ${f.away_team}</td>
          <td><input type="number" id="h${f.id}" min="0"></td>
          <td><input type="number" id="a${f.id}" min="0"></td>
        </tr>`).join("") + `</table>`;
    }
    document.getElementById("saveBtn").onclick = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      let { data: prof } = await supabase.from("profiles").select("*").eq("id", user.id).maybeSingle();
      let rows = [];
      document.querySelectorAll("input[type=number]").forEach(inp=>{
        if(inp.value!==""){
          const fid = inp.id.substring(1);
          const isHome = inp.id.startsWith("h");
          let existing = rows.find(r=>r.fixture_id==fid);
          if(!existing) { existing = { fixture_id: fid, user_id: user.id, nickname: prof?.nickname||"" }; rows.push(existing); }
          if(isHome) existing.home_pred = parseInt(inp.value);
          else existing.away_pred = parseInt(inp.value);
        }
      });
      if(rows.length) {
        await supabase.from("predictions").upsert(rows);
        document.getElementById("msg").textContent="Saved!";
      }
    }
    loadFixtures();
  </script>
</body>
</html>
