<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard • Weekend Predictor</title>

  <link rel="stylesheet" href="brand.css" />

  <!-- ✅ Load Supabase UMD first -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

  <!-- ✅ Then load your config -->
  <script src="supabase-config.js?v=3"></script>

  <style>
    :root{
      --text:#e9eefc; --muted:#9aa7c7; --border:rgba(255,255,255,.08);
      --accent:#8ab3ff; --bg1:rgba(11,18,32,.85); --bg2:rgba(14,22,48,.85);
    }
    html,body{height:100%;margin:0;}
    body{
      color:var(--text);
      font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,system-ui,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2)),url("prem-hero.jpg") center/cover no-repeat fixed;
      display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
      min-height:100vh;text-align:center;padding:40px 16px;
    }
    h1{font-weight:800;font-size:2rem;margin-bottom:12px;}
    .muted{color:var(--muted);}
    table{width:100%;max-width:600px;margin-top:20px;border-collapse:collapse;background:rgba(255,255,255,.05);border-radius:10px;overflow:hidden;}
    th,td{padding:12px 16px;border-bottom:1px solid var(--border);}
    th{background:rgba(255,255,255,.1);font-weight:700;}
    tr:last-child td{border-bottom:none;}
    a.btn{display:inline-block;margin-top:20px;padding:12px 18px;border-radius:10px;border:1px solid var(--border);text-decoration:none;color:var(--text);}
    a.btn:hover{border-color:#2a3a5a;}
  </style>
</head>
<body>
  <div class="logo" style="width:90px;height:90px;border-radius:50%;background:#0c1a34;display:grid;place-items:center;border:1px solid var(--border);box-shadow:0 0 25px rgba(122,164,255,.25),inset 0 0 20px rgba(122,164,255,.1);margin-bottom:16px;">
    <img src="assets/brand-logo.png" alt="WP Logo" style="width:60px;height:60px;border-radius:50%;" />
  </div>
  <h1>Leaderboard</h1>
  <p class="muted" id="status">Loading...</p>

  <table id="board" class="hidden">
    <thead><tr><th>Player</th><th>Points</th></tr></thead>
    <tbody id="rows"></tbody>
  </table>

  <a href="profile.html" class="btn">Profile</a>
  <a href="index.html" class="btn">Home</a>

  <script>
    (async () => {
      // 1️⃣ Ensure any magic-link session is hydrated
      await supabase.auth.getSession();

      // 2️⃣ Check session
      const { data: { session } } = await supabase.auth.getSession();
      const status = document.getElementById('status');
      const table = document.getElementById('board');
      const rows = document.getElementById('rows');

      if (!session) {
        status.textContent = 'Not signed in. Redirecting...';
        setTimeout(() => window.location.replace('login.html'), 1200);
        return;
      }

      status.textContent = 'Welcome back!';
      table.classList.remove('hidden');

      // 3️⃣ Example: Fetch leaderboard data (replace with your real table)
      try {
        const { data, error } = await supabase.from('leaderboard').select('*').order('points', { ascending: false });
        if (error) throw error;
        if (!data || !data.length) {
          status.textContent = 'No leaderboard data found yet.';
          return;
        }

        // Render table
        rows.innerHTML = data.map((p) =>
          `<tr><td>${p.player || p.name}</td><td>${p.points}</td></tr>`
        ).join('');
      } catch (err) {
        console.error(err);
        status.textContent = 'Error loading leaderboard.';
      }
    })();
  </script>
</body>
</html>
