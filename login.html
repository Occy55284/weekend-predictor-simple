<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login • Weekend Predictor</title>
  <link rel="stylesheet" href="brand.css" />
  <script defer src="supabase-config.js"></script>
  <script>
    async function handleLogin(e) {
      e.preventDefault();
      const emailInput = document.getElementById('email');
      const message = document.getElementById('message');
      const email = emailInput.value.trim();

      message.textContent = '';
      if (!email) {
        message.textContent = 'Please enter your email.';
        return;
      }

      try {
        const { data, error } = await supabase.auth.signInWithOtp({
          email,
          options: {
            emailRedirectTo: window.location.origin + '/predict.html'
          }
        });

        if (error) {
          console.error(error);
          message.textContent = error.message || 'Error sending magic link.';
        } else {
          message.textContent = 'Magic link sent! Please check your email.';
          emailInput.value = '';
        }
      } catch (err) {
        console.error(err);
        message.textContent = 'Unexpected error. Please try again.';
      }
    }
  </script>
</head>
<body>
  <div class="page-shell">
    <header class="top-nav">
      <div class="top-nav-left">
        <div class="nav-logo">
          <img src="assets/brand-logo.png" alt="Weekend Predictor logo" />
        </div>
        <div class="nav-text-group">
          <div class="nav-title">Weekend Predictor</div>
          <div class="nav-subtitle">Premier League prediction challenge</div>
        </div>
      </div>
      <nav class="top-nav-links">
        <a href="index.html">Home</a>
        <a href="leaderboard.html">Leaderboard</a>
        <a href="my-picks.html">My Picks</a>
        <a href="profile.html">Profile</a>
        <a href="admin.html">Admin</a>
      </nav>
    </header>

    <main class="main-layout">
      <section class="panel panel-main">
        <div class="panel-inner">
          <h1>Log in with magic link</h1>
          <p class="muted">
            Enter your email and we’ll send you a secure one-time link to access your predictions.
          </p>

          <form class="form" onsubmit="handleLogin(event)">
            <label class="form-label" for="email">Work email</label>
            <input
              id="email"
              type="email"
              class="input"
              placeholder="you@company.com"
              autocomplete="email"
              required
            />

            <button class="btn-primary" type="submit">
              Send magic link
            </button>
            <p id="message" class="form-message"></p>
          </form>

          <p class="muted" style="margin-top:12px; font-size:.85rem;">
            No passwords, no hassle. Just click the link in your inbox and you’re in.
          </p>
        </div>
      </section>

      <aside class="panel panel-side">
        <div class="panel-inner">
          <h2>How it works</h2>
          <ul class="muted bullet-list">
            <li>Use your work email to get a magic sign-in link.</li>
            <li>Make your score predictions for each Premier League game.</li>
            <li>Track your progress on the live leaderboard.</li>
          </ul>

          <div class="info-card">
            <div class="info-label">Tip</div>
            <p class="info-text">
              Save the magic link email in case you want to log back in from the same device later.
            </p>
          </div>
        </div>
      </aside>
    </main>
  </div>
</body>
</html>
