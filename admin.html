<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin</title>
  <link rel="stylesheet" href="brand.css?v=11" />
</head>
<body>
  <main class="landing">
    <svg class="logo" viewBox="0 0 64 64" aria-hidden="true">
      <rect x="2" y="2" width="60" height="60" rx="12" fill="#1E824C"></rect>
      <circle cx="32" cy="32" r="16" fill="#FFF" stroke="#0E3E2A" stroke-width="3"></circle>
      <path d="M32 16 l6 6 -6 4 -6-4z M32 48 l6-6 -6-4 -6 4z M16 32 l6-6 4 6 -4 6z M48 32 l-6-6 -4 6 4 6z"
            fill="#0E3E2A"></path>
    </svg>

    <div class="card" style="max-width:680px">
      <h2>Admin Dashboard</h2>
      <p style="margin:10px 0 18px;color:#444">Welcome. Choose an action:</p>
      <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
        <a class="cta" href="leaderboard.html">View Leaderboard</a>
        <a class="cta" href="predict.html">Impersonate Picks</a>
        <!-- Add more admin links as you build (fixtures editor, lock week, etc.) -->
      </div>
      <button id="logout" style="margin-top:18px;background:#999;color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;">
        Logout
      </button>
      <p id="status" style="margin-top:10px;font-size:.9rem;color:#1f357a;"></p>
    </div>
  </main>

  <script type="module" src="supabase-config.js"></script>
  <script type="module">
    import { supabase } from './supabase-config.js';

    const statusEl = document.getElementById('status');
    const logoutBtn = document.getElementById('logout');

    // Require session
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
      window.location.replace('login.html');
    }

    // Check admin
    const { data, error } = await supabase
      .from('profiles')
      .select('is_admin')
      .eq('id', session.user.id)
      .single();

    if (error) {
      console.error(error);
      statusEl.textContent = 'Error checking access';
    } else if (!data?.is_admin) {
      // Not admin â†’ send away
      window.location.replace('profile.html');
    }

    // Logout
    logoutBtn.addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.replace('login.html');
    });
  </script>
</body>
  <!-- Mini top-right nav -->
<nav class="topnav">
  <a href="predict.html" data-nav="predict">Predict</a>
  <a href="my-picks.html" data-nav="mypicks">My Picks</a>
  <a href="leaderboard.html" data-nav="leaderboard">Leaderboard</a>
  <a href="profile.html" data-nav="profile">Profile</a>
  <a href="admin.html" id="navAdmin" data-nav="admin" style="display:none">Admin</a>
  <button class="logout" id="navLogout" title="Sign out">Logout</button>
</nav>

<script type="module">
  import { supabase } from './supabase-config.js';

  // Highlight the current page
  const path = location.pathname.toLowerCase();
  const markActive = (key) => {
    const el = document.querySelector(`.topnav [data-nav="${key}"]`);
    if (el) el.classList.add('active');
  };
  if (path.endsWith('/predict.html')) markActive('predict');
  else if (path.endsWith('/my-picks.html')) markActive('mypicks');
  else if (path.endsWith('/leaderboard.html')) markActive('leaderboard');
  else if (path.endsWith('/profile.html')) markActive('profile');
  else if (path.endsWith('/admin.html')) markActive('admin');

  // Show Admin link for admins
  try {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
      const { data, error } = await supabase
        .from('profiles')
        .select('is_admin')
        .eq('id', session.user.id)
        .single();
      if (!error && data?.is_admin) {
        document.getElementById('navAdmin').style.display = '';
      }
    }
  } catch (e) {
    console.warn('Nav init warning:', e?.message || e);
  }

  // Logout
  document.getElementById('navLogout').addEventListener('click', async () => {
    await supabase.auth.signOut();
    location.replace('login.html');
  });
</script>

</html>









