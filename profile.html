<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>My Profile · Occy Weekend Football</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <style>
    body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; padding:24px;
      min-height:100vh; display:grid; place-items:center;
      background:linear-gradient(135deg,#0f172a,#1e3a8a,#0f172a); color:#fff; }
    .card{ background:rgba(255,255,255,.95); color:#111; border-radius:12px; padding:20px; width:min(520px,92%); box-shadow:0 4px 12px rgba(0,0,0,.3);}
    h1{ margin:0 0 10px; color:#0f172a;}
    label{ display:block; margin:12px 0 6px;}
    input,select{ width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;}
    button{ margin-top:14px; padding:12px 16px; border:none; border-radius:8px; background:#1e3a8a; color:#fff; font-size:16px; cursor:pointer;}
    button:hover{ background:#3746c2;}
    .muted{ color:#555; font-size:14px; margin-top:8px;}
    a{ color:#0f172a;}
    .req{ color:#b91c1c; font-size:12px; margin-top:4px; display:none; }
    .ok{ color:#065f46; font-size:14px; margin-top:8px; display:none; }
    .row{ display:flex; gap:10px; margin-top:6px; align-items:center; }
  </style>
</head>
<body>
  <div class="card">
    <h1>My Profile</h1>
    <p class="muted">Please set a <b>display name</b> and your <b>favourite team</b>. These are required before you can make predictions.</p>

    <label for="name">Display name / nickname</label>
    <input id="name" type="text" placeholder="e.g., Occy" />
    <div id="nameReq" class="req">Display name is required.</div>

    <label for="team">Favourite team</label>
    <select id="team">
      <option value="">— Pick a team —</option>
      <option>Arsenal</option>
      <option>Aston Villa</option>
      <option>AFC Bournemouth</option>
      <option>Brentford</option>
      <option>Brighton & Hove Albion</option>
      <option>Chelsea</option>
      <option>Crystal Palace</option>
      <option>Everton</option>
      <option>Fulham</option>
      <option>Ipswich Town</option>
      <option>Leicester City</option>
      <option>Liverpool</option>
      <option>Manchester City</option>
      <option>Manchester United</option>
      <option>Newcastle United</option>
      <option>Nottingham Forest</option>
      <option>Southampton</option>
      <option>Tottenham Hotspur</option>
      <option>West Ham United</option>
      <option>Wolverhampton Wanderers</option>
    </select>
    <div id="teamReq" class="req">Favourite team is required.</div>

    <div class="row">
      <button id="save">Save</button>
      <button id="home">← Back to home</button>
    </div>

    <div id="ok" class="ok">Saved! You can now make predictions.</div>
    <p id="msg" class="muted"></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script>
    const client = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    const nameEl = document.getElementById('name');
    const teamEl = document.getElementById('team');
    const nameReq = document.getElementById('nameReq');
    const teamReq = document.getElementById('teamReq');
    const okEl = document.getElementById('ok');
    const msg = document.getElementById('msg');

    document.getElementById('home').onclick = ()=> location.href='index.html';

    async function init(){
      const { data: ur } = await client.auth.getUser();
      const u = ur?.user;
      if (!u){ location.replace('login.html'); return; }

      const { data: prof } = await client
        .from('profiles')
        .select('display_name, favorite_team')
        .eq('id', u.id)
        .maybeSingle();

      if (prof){
        if (prof.display_name) nameEl.value = prof.display_name;
        if (prof.favorite_team) teamEl.value = prof.favorite_team;
      }
    }

    document.getElementById('save').addEventListener('click', async ()=>{
      nameReq.style.display = 'none';
      teamReq.style.display = 'none';
      okEl.style.display = 'none';
      msg.textContent = '';

      const display_name = nameEl.value.trim();
      const favorite_team = teamEl.value;

      if (!display_name) nameReq.style.display = 'block';
      if (!favorite_team) teamReq.style.display = 'block';
      if (!display_name || !favorite_team) return;

      const { data: ur } = await client.auth.getUser();
      const u = ur?.user; if (!u){ location.replace('login.html'); return; }

      const { error } = await client.from('profiles').upsert({ id: u.id, display_name, favorite_team });
      if (error){
        msg.textContent = 'Error: ' + error.message;
        return;
      }
      okEl.style.display = 'block';
      msg.textContent = 'All set. Head to Make Predictions!';
    });

    init();
  </script>
</body>
</html>




