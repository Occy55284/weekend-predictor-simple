<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>My Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="assets/logo-pick.png" />
  <link rel="stylesheet" href="brand.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><img class="brand-logo" src="assets/logo-pick.png" alt="">My Profile</h1>
      <p class="muted">Set your nickname and favourite team.</p>
    </div>

    <div class="card">
      <form id="form">
        <label for="name">Nickname</label>
        <input type="text" id="name" />

        <label for="team">Favourite Team Badge URL</label>
        <input type="text" id="team" placeholder="Paste image URL" />

        <button type="submit" class="btn">Save Profile</button>
      </form>
      <div id="msg" class="muted"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script>
    const client = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    const nameEl=document.getElementById('name');
    const teamEl=document.getElementById('team');
    const msg=document.getElementById('msg');

    async function load(){
      const { data: ur } = await client.auth.getUser();
      const u=ur?.user; if(!u){ location.replace('login.html'); return; }
      const { data } = await client.from('profiles')
        .select('display_name,favorite_team').eq('id',u.id).maybeSingle();
      if(data){ nameEl.value=data.display_name||''; teamEl.value=data.favorite_team||''; }
    }

    async function save(e){
      e.preventDefault();
      const { data: ur } = await client.auth.getUser();
      const u=ur?.user;
      if(!u){ location.replace('login.html'); return; }
      const { error } = await client.from('profiles').upsert({
        id:u.id, display_name:nameEl.value, favorite_team:teamEl.value
      });
      if(error){ msg.textContent='Error: '+error.message; }
      else { msg.textContent='Saved âœ”'; }
    }

    document.getElementById('form').addEventListener('submit',save);
    load();
  </script>
</body>
</html>





