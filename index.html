<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekend Predictor</title>
  <meta name="description" content="Pick five featured fixtures, lock your scorelines, and climb the leaderboard with friends. Zero spreadsheets. Just weekend glory." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#0b1540;
      --muted:#485a86;
      --brand:#2a43d6;
      --brand-2:#1b2e9a;
      --accent:#16a34a;
      --card:#ffffff;
      --ring:rgba(42,67,214,.4);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink);
      /* animated gradient sky */
      background:
        radial-gradient(1000px 520px at 50% -10%, #2746bf 0%, rgba(39,70,191,0) 60%),
        linear-gradient(180deg, #10255a 0%, #142b67 40%, #0f2257 100%);
      position:relative; overflow-x:hidden;
    }

    /* soft grain + lights */
    .sky:before, .sky:after{
      content:""; position:fixed; inset:-5vh -5vw; pointer-events:none;
    }
    .sky:before{
      background:
        radial-gradient(600px 240px at 20% 15%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(700px 280px at 80% 12%, rgba(0,186,255,.07), transparent 65%),
        radial-gradient(500px 220px at 50% 0%, rgba(22,163,74,.09), transparent 60%);
      filter:saturate(110%);
      animation: drift 22s ease-in-out infinite alternate;
    }
    .sky:after{
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 40 40'%3E%3Cg fill='%23ffffff' fill-opacity='.04'%3E%3Ccircle cx='2' cy='2' r='1'/%3E%3Ccircle cx='22' cy='8' r='1'/%3E%3Ccircle cx='10' cy='22' r='1'/%3E%3Ccircle cx='32' cy='28' r='1'/%3E%3Ccircle cx='18' cy='36' r='1'/%3E%3C/g%3E%3C/svg%3E");
      mix-blend-mode:soft-light; opacity:.8;
    }
    @keyframes drift{
      0%{transform:translate3d(0,0,0) scale(1)}
      100%{transform:translate3d(0,-2%,0) scale(1.03)}
    }

    /* Top nav (simple) */
    .topnav{
      position:sticky; top:0; z-index:5;
      display:flex; justify-content:flex-end; gap:10px; padding:12px 16px;
      background:linear-gradient(180deg, rgba(8,19,54,.55), rgba(8,19,54,0));
      backdrop-filter:saturate(140%) blur(4px);
    }
    .topnav a, .topnav button{
      color:#e8eeff; text-decoration:none; font-weight:800; font-size:.95rem;
      padding:8px 12px; border-radius:10px; border:0; background:transparent; cursor:pointer;
    }
    .topnav a:hover, .topnav button:hover{ background:rgba(255,255,255,.08) }

    /* Hero card */
    .hero{max-width:1080px;margin:60px auto 0;padding:0 18px; position:relative; z-index:2}
    .brandicon{display:block;margin:0 auto 16px;width:58px;height:58px;filter:drop-shadow(0 10px 20px rgba(0,0,0,.35))}
    .card{
      background:
        radial-gradient(900px 400px at 50% -40%, rgba(255,255,255,.9), rgba(255,255,255,.98)),
        linear-gradient(180deg, #ffffff, #f7f9ff);
      border:1px solid rgba(255,255,255,.55);
      box-shadow:0 30px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.8);
      border-radius:24px; padding:36px 22px 28px; text-align:center;
    }
    h1{font-weight:900; letter-spacing:.2px; color:#0d1e53; margin:0 0 8px;
      font-size: clamp(30px, 6vw, 56px); line-height:1.05}
    .lead{color:#41528c; font-size: clamp(16px, 2.4vw, 20px); margin:6px 0 18px}

    .cta{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:12px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      border:0; border-radius:14px; padding:14px 20px; font-weight:900; letter-spacing:.2px;
      cursor:pointer; transition:transform .08s ease, box-shadow .18s ease, filter .18s ease;
    }
    .btn:focus{outline:3px solid var(--ring); outline-offset:2px}
    .btn.primary{
      color:#fff;
      background:linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow:0 14px 30px rgba(42,67,214,.35), inset 0 1px 0 rgba(255,255,255,.15);
    }
    .btn.primary:hover{ transform:translateY(-1px); filter:saturate(110%); box-shadow:0 18px 40px rgba(42,67,214,.45) }
    .btn.secondary{ background:#eef1ff; color:#1a2d84; box-shadow:inset 0 1px 0 rgba(255,255,255,.8) }
    .btn.secondary:hover{ filter:saturate(110%) }

    /* Steps */
    .steps{max-width:1080px;margin:22px auto 0;padding:0 18px; display:grid; gap:12px}
    @media(min-width:900px){ .steps{grid-template-columns:repeat(3,1fr)} }
    .step{
      background:rgba(255,255,255,.9); border:1px solid rgba(255,255,255,.6);
      border-radius:18px; padding:16px; box-shadow:0 10px 24px rgba(0,0,0,.18);
    }
    .step h3{margin:6px 0 6px; color:#0f2257}
    .step p{margin:0; color:#425185}

    /* Feature cards */
    .features{max-width:1080px;margin:16px auto 40px;padding:0 18px; display:grid; gap:12px}
    @media(min-width:900px){ .features{grid-template-columns:repeat(3,1fr)} }
    .feature{
      background:linear-gradient(180deg, #ffffff, #f6f9ff);
      border:1px solid rgba(255,255,255,.65); border-radius:18px; padding:16px;
      box-shadow:0 10px 26px rgba(0,0,0,.22);
    }
    .tag{display:inline-block;background:#eaf3ff;color:#1b2f96;font-weight:800;font-size:.75rem;padding:4px 9px;border-radius:999px;margin-bottom:8px}

    /* Footer CTA */
    .footcta{max-width:900px;margin:0 auto 60px;padding:0 18px;text-align:center}
    .footcta .band{
      background:linear-gradient(135deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
      border:1px solid rgba(255,255,255,.65); border-radius:18px; padding:16px 18px;
      box-shadow:0 10px 28px rgba(0,0,0,.22)
    }

    /* Small utilities */
    .muted{color:#6b7bb0}
    .hide{display:none !important}
  </style>
</head>
<body>
  <div class="sky"></div>

  <!-- Top nav -->
  <nav class="topnav" id="topnav">
    <a href="login.html" id="navStart">Get Started</a>
    <a href="leaderboard.html" class="hide" id="navLb">Leaderboard</a>
    <a href="predict.html" class="hide" id="navPredict">Predict</a>
    <a href="my-picks.html" class="hide" id="navPicks">My Picks</a>
    <button id="navLogout" class="hide">Logout</button>
  </nav>

  <main class="hero">
    <!-- brand icon -->
    <svg class="brandicon" viewBox="0 0 64 64" aria-hidden="true">
      <rect x="2" y="2" width="60" height="60" rx="12" fill="#1E824C"></rect>
      <circle cx="32" cy="32" r="16" fill="#FFF" stroke="#0E3E2A" stroke-width="3"></circle>
      <path d="M32 16 l6 6 -6 4 -6-4z M32 48 l6-6 -6-4 -6 4z M16 32 l6-6 4 6 -4 6z M48 32 l-6-6 -4 6 4 6z" fill="#0E3E2A"></path>
    </svg>

    <!-- HERO -->
    <section class="card">
      <h1>Predict the weekend. Beat your friends.</h1>
      <p class="lead">Pick scores for the five featured fixtures. Lock in, watch the drama, and climb the leaderboard. Zero spreadsheets. Just weekend glory.</p>
      <div class="cta" id="ctaSignedOut">
        <a class="btn primary" href="login.html">Get started</a>
        <a class="btn secondary" href="leaderboard.html">See leaderboard</a>
      </div>
      <div class="cta hide" id="ctaSignedIn">
        <a class="btn primary" href="predict.html">Make your picks</a>
        <a class="btn secondary" href="leaderboard.html">See leaderboard</a>
        <a class="btn secondary" href="my-picks.html">My picks</a>
      </div>
    </section>

    <!-- Steps -->
    <section class="steps">
      <div class="step">
        <div class="tag">1 · Sign in</div>
        <h3>Create your profile</h3>
        <p>Magic-link sign-in. Pick a nickname and your favourite club.</p>
      </div>
      <div class="step">
        <div class="tag">2 · Predict</div>
        <h3>Choose scorelines</h3>
        <p>Admins select five fixtures each week. You predict the scores and lock them in.</p>
      </div>
      <div class="step">
        <div class="tag">3 · Brag</div>
        <h3>Track the bragging rights</h3>
        <p>Points update as results roll in. Check weekly and season ranks.</p>
      </div>
    </section>

    <!-- Features -->
    <section class="features">
      <div class="feature">
        <div class="tag">Auto-updates</div>
        <h3>Live results in your table</h3>
        <p class="muted">Scores sync automatically, so your leaderboard keeps pace with the action.</p>
      </div>
      <div class="feature">
        <div class="tag">Lock &amp; go</div>
        <h3>No spoilers, fair game</h3>
        <p class="muted">Lock your picks before kickoff. Once locked, you can sit back and enjoy the ride.</p>
      </div>
      <div class="feature">
        <div class="tag">Zero faff</div>
        <h3>Built for mates’ leagues</h3>
        <p class="muted">No spreadsheets. No ads. Just the fun bits — picks, banter, and bragging rights.</p>
      </div>
    </section>

    <!-- Footer CTA -->
    <section class="footcta">
      <div class="band">
        <strong>Ready to play?</strong>
        <div class="cta" style="margin-top:8px">
          <a class="btn primary" href="login.html">Get started</a>
          <a class="btn secondary" href="leaderboard.html">See leaderboard</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Auth catcher: complete magic-link here & route -->
  <script type="module" src="supabase-config.js"></script>
  <script type="module">
    import { supabase } from './supabase-config.js';

    async function routeAfterLogin(userId){
      try{
        const { data: prof } = await supabase
          .from('profiles').select('display_name,is_admin').eq('id', userId).maybeSingle();
        if (prof?.is_admin) { window.location.replace('admin.html'); return; }
        if (prof?.display_name) { window.location.replace('predict.html'); return; }
        window.location.replace('profile.html');
      }catch{
        window.location.replace('predict.html');
      }
    }

    // Complete auth if magic link landed here
    async function handleAuthRedirectHere(){
      const url = new URL(location.href);
      const code = url.searchParams.get('code');
      if (code){
        try{
          const { data, error } = await supabase.auth.exchangeCodeForSession(code);
          if (error) throw error;
          await routeAfterLogin(data.user.id);
          return;
        }catch(e){ console.error('index: exchangeCode error', e); }
      }
      if (location.hash && location.hash.includes('access_token')){
        const params = new URLSearchParams(location.hash.substring(1));
        const access_token = params.get('access_token');
        const refresh_token = params.get('refresh_token');
        if (access_token && refresh_token){
          try{
            const { data, error } = await supabase.auth.setSession({ access_token, refresh_token });
            if (error) throw error;
            history.replaceState({}, document.title, location.pathname);
            await routeAfterLogin(data.user.id);
            return;
          }catch(e){ console.error('index: setSession error', e); }
        }
      }
    }
    handleAuthRedirectHere();

    // If already signed in, swap CTAs + show nav items
    (async ()=>{
      const { data: { session } } = await supabase.auth.getSession();
      const signedIn = !!session?.user;
      document.getElementById('ctaSignedOut').classList.toggle('hide', signedIn);
      document.getElementById('ctaSignedIn').classList.toggle('hide', !signedIn);

      // Topnav toggles
      document.getElementById('navLb').classList.toggle('hide', !signedIn);
      document.getElementById('navPredict').classList.toggle('hide', !signedIn);
      document.getElementById('navPicks').classList.toggle('hide', !signedIn);
      document.getElementById('navStart').classList.toggle('hide', signedIn);
      document.getElementById('navLogout').classList.toggle('hide', !signedIn);

      // Logout wire
      const navLogout = document.getElementById('navLogout');
      if (navLogout){
        navLogout.addEventListener('click', async ()=>{
          await supabase.auth.signOut();
          window.location.replace('login.html');
        });
      }
    })();
  </script>
</body>
</html>
